classDiagram
  subgraph Core
    class System {
      -world
      +initialize()
      +update()
      +handle_event()
      +entities_with()
      +emit_event()
      +queue_command()
    }
  end
  subgraph Systems
    class MessageSystem {
      -logger
      -manager
      -message_queue
      +initialize()
      +setup_panel()
      +render()
      +log_message()
      +log_success()
      +log_warning()
      +log_critical()
      +get_recent_messages()
      +handle_input()
      +toggle_selection_mode()
      +selection_mode?()
      +cleanup()
      +update()
      +handle_event()
      +add_message()
      +process_message_queue()
      +trim_message_queue()
      +importance_value()
    }
    class CollisionSystem {
      -logger
      +initialize()
      +update()
      +handle_event()
      +find_entities_at_position()
      +handle_specific_collisions()
    }
    System <|-- CollisionSystem
    class InputSystem {
      -logger
      +initialize()
      +update()
      +process_input()
    }
    System <|-- InputSystem
    class InventoryRenderSystem {
      -renderer
      -logger
      -message_system
      -currently_selected_item_index
      -item_action_mode
      +initialize()
      +render_inventory()
      +render_equipment_section()
      +select_item()
      +show_item_actions()
      +handle_input()
      +draw_text()
      +draw_panel_border()
      +get_item_color()
      +get_item_display_string()
      +show_item_details()
    }
    class InventorySystem {
      -logger
      -message_system
      +initialize()
      +add_item()
      +remove_item()
      +use_item()
      +equip_item()
      +unequip_item()
      +drop_item()
      +item_name()
      +use_consumable()
      +toggle_equip()
      +log_message()
    }
    class ItemInteractionSystem {
      -inventory_system
      -message_system
      +initialize()
      +process_items_at_location()
      +pickup_item()
      +pickup_all_items()
      +find_items_at_position()
    }
    class MonsterSystem {
      -player
      -monsters
      -logger
      -rng
      +initialize()
      +spawn_monsters()
      +update()
      +monster_at()
      +player_collision?()
      +determine_monster_count()
      +spawn_monster()
      +find_spawn_location()
      +select_weighted_monster_type()
      +valid_move?()
    }
    System <|-- MonsterSystem
    class MovementSystem {
      -logger
      +initialize()
      +update()
      +process_entity_movement()
      +move()
      +can_process?()
      +normalize_direction()
      +get_target_cell()
      +can_move_to?()
      +handle_special_cell_attributes()
      +update_position()
      +log_movement()
    }
    System <|-- MovementSystem
    class RenderSystem {
      -renderer
      -difficulty
      -seed
      -logger
      +initialize()
      +update()
      +render_grid()
      +render_messages()
    }
    System <|-- RenderSystem
    class System {
      -world
      +initialize()
      +update()
      +handle_event()
      +entities_with()
      +emit_event()
      +queue_command()
    }
  end
  %% Relationships
